<!DOCTYPE html> 
<html> 
	<head> 
	<title>My Page</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>

	<script type="text/javascript">
		var couponstuff;
		var runfunction;
		var testing = [];
		var count = 0;
		var newcoupon = {};
		var datastructure = [];
		var client = new XMLHttpRequest();
		client.open('GET', '/coupons.csv');
		client.onreadystatechange = function() {
			couponstuff = client.responseText
		  	runfunction();

		}
		client.send();

		//gets called after the csv has been loaded in
		runfunction = function(){
			testing = JSON.parse( localStorage.getItem( 'couponlist' ) );
			
			if (localStorage.clickcount == null || localStorage.clickcount == 0) {
				var partofstring = couponstuff.split(',');
				if (partofstring[1]!=null && count==0) {
					for (var i = 0; i < partofstring.length; i++) {
						partofstring[i] = partofstring[i].replace('"','');
					};
					for (var i = 0; i < ((partofstring.length)/4); i++) {
								datastructure.push({
									store: partofstring[(i*4)],
									category: partofstring[(i*4)+1],
									expirationdate: partofstring[(i*4)+2],
									specifics: partofstring[(i*4)+3]
							})
						

					};
					console.log(datastructure)
					testing = datastructure;
					console.log(testing)
					count++;
					localStorage.clickcount=0;
				};
			}
			else{
				console.log("hello")
				console.log(JSON.parse( localStorage.getItem('couponlist')))
			}
		}

		

		
	</script>

<style type="text/css">

	.ui-page{
		background: transparent url("background.jpg");
		background-size: 200% 100%;
		background-repeat: no-repeat;
	}

</style>

</head> 
<body id="mainpage" style="background-image: url("background.jpg")"> 

<div data-role="page" >

	<div data-role="header">
		<a href="information.html" data-transition="slide" data-icon="info" class="ui-btn-right">Information</a>
		<h1>Crazy Coupons</h1>
		<a href="options.html" data-transition="slide" data-direction="reverse" data-icon="gear" class="ui-btn-left">Options</a>
	</div><!-- /header -->

	<div data-role="content">	
		<div data-role="controlgroup" data-type="horizontal" style="text-align:center;">
			<a href="index.html" data-transition="fade" data-role="button" data-icon="home" data-theme="b">Home</a>
			<a href="map.html" data-transition="fade" data-role="button" data-icon="navigation">Map</a>
			<a href="trending.html" data-transition="fade" data-role="button" data-icon="star">Trending</a>
			<a href="camera.html" data-transition="fade" data-role="button" data-icon="camera">Camera</a>
		</div>		


		<form>
			<div class="ui-field-contain">
	    		<label align="center" for="select-native-2">Sort By:</label>
			    <select onchange="window.open(this.value,'_self','');" name="select-native-2" id="select-native-2" data-mini="true">
			        <option>Clothing</option>
			        <option value="index.html">Expiration Date</option>
			        <option value="foodsort.html">Food</option>
			        <option value="producesort.html">Produce</option>
			    </select>
			</div>
		</form>


		<ul data-role="listview" data-inset="true" data-filter="true">
			<li><a href="#" onclick="addtoJson()">
				<h1>Macy's</h1>
				<h2>50% off sale</h2>
				<h3 class="ui-li-aside">4/25/16</h3>
			</a></li>
			<li><a href="#">
				<h1>American Eagle</h1>
				<h2>BOGO 25% off</h2>
				<h3 class="ui-li-aside">5/5/16</h3>
			</a></li>
			
		</ul>

		<script type="text/javascript">

			var addtoJson = function(){
				
				newcoupon = {
					store: "New Store",
					category: "Random",
					expirationdate: "6/30/16",
					specifics: "Some Deal"
				};

				if (localStorage.couponlist != null) {
					datastructure = JSON.parse( localStorage.getItem('couponlist'));
				};

				datastructure.push(newcoupon)
				console.log(datastructure)
				localStorage.setItem( 'couponlist', JSON.stringify(datastructure) );
				

				localStorage.clickcount++;
			}




		</script>
	</div><!-- /content -->

</div><!-- /page -->

</body>
</html>